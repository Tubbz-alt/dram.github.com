article: SHELL中的文件锁

	在SHELL中实现文件锁，有两种简单的方式。

	一是利用普通文件，在脚本启动时检查特定文件是否存在，如果存在，则等待一段时间后继续检查，直到文件不存时创建该文件，在脚本结束时删除文件。为确保脚本在异常退出时文件仍然能被删除，可以借助于`trap "cmd" EXIT TERM INT`命令。一般这类文件存放在`/var/lock/`目录下，操作系统在启动时会对该目录做清理。

	另一种方法是是使用`flock`命令。使用方式如下，这个命令的好处是等待动作在flock命令中完成，无需另外添加代码。

	```
		(
		flock 300
		...cmd...
		flock -u 300
		) > /tmp/file.lock

	但flock有个缺陷是，在打开flock之后fork()，子进程也会拥有锁，如果在flock其间有运行daemon的话，必需确保daemon在启动时已经关闭了所有的文件句柄，不然该文件会因为daemon一直将其置于打开状态而无法解锁。
